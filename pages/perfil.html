<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meu Perfil - FashionSpace</title>
    <link rel="stylesheet" href="../css/perfil-style.css">
    <link rel="stylesheet" href="../css/dark-mode-detalhes.css">
    <link rel="stylesheet" href="../css/analytics.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <img src="../assets/Image.png" alt="Logo" class="sidebar-logo">
            <h3>FashionSpace</h3>
        </div>
        <ul class="sidebar-menu">
            <li><a href="../index.html"><i class="fas fa-home"></i> Início</a></li>
            <li><a href="#bazares"><i class="fas fa-store"></i> Bazares</a></li>
            <li><a href="favoritos.html"><i class="fas fa-heart"></i> Favoritos</a></li>
            <li><a href="perfil.html"><i class="fas fa-user"></i> Perfil</a></li>
            <li><a href="#" onclick="toggleDarkMode()"><i class="fas fa-moon"></i> <span id="darkModeText">Modo Escuro</span></a></li>
        </ul>
    </nav>
    
    <div class="main-content">
        <nav class="topbar">
            <button class="menu-toggle" id="menuToggle">
                <i class="fas fa-bars"></i>
            </button>
            <h2 style="color: white; flex: 1; text-align: center; margin: 0;">Perfil</h2>
            <div class="header-actions">
                <button class="add-bazar-btn" onclick="window.location.href='adicionar-bazar.html'">
                    <i class="fas fa-plus"></i>
                    Adicionar Bazar
                </button>
                <button class="profile-btn" onclick="window.location.href='perfil.html'">
                    <i class="fas fa-user-circle"></i>
                    Perfil
                </button>
            </div>
        </nav>
        
        <div class="container">
            <!-- Header -->
            <header class="profile-header">
            <button class="back-btn" onclick="window.location.href='../index.html'" style="background: #5f81a5; color: white; border: none;">
                <i class="fas fa-arrow-left"></i>
                Voltar
            </button>
            <h1>Meu Perfil</h1>
            <div class="header-actions">
                <button class="edit-btn" id="editBtn">
                    <i class="fas fa-edit"></i>
                    Editar
                </button>
                <button class="logout-btn" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i>
                    Sair
                </button>
            </div>
        </header>

        <!-- Profile Content -->
        <div class="profile-content">
            <!-- Profile Card -->
            <div class="profile-card">
                <div class="profile-avatar">
                    <img src="../assets/OIP.webp" alt="Avatar" id="avatarImg">
                    <button class="avatar-edit" id="avatarEdit">
                        <i class="fas fa-camera"></i>
                    </button>
                    <input type="file" id="avatarInput" accept="image/*" hidden>
                </div>
                <div class="profile-info">
                    <h2 id="userName">Usuário</h2>
                    <p id="userEmail">email@exemplo.com</p>
                    <span class="user-badge">Membro desde 2024</span>
                </div>
            </div>

            <!-- Profile Details -->
            <div class="profile-details">
                <div class="details-section">
                    <h3>Informações Pessoais</h3>
                    <div class="info-grid">
                        <div class="info-item">
                            <label>Nome Completo</label>
                            <span id="fullName">Usuário</span>
                        </div>
                        <div class="info-item">
                            <label>Email</label>
                            <span id="email">email@exemplo.com</span>
                        </div>
                        <div class="info-item">
                            <label>Telefone</label>
                            <span id="phone">(11) 99999-9999</span>
                        </div>
                        <div class="info-item">
                            <label>Localização</label>
                            <span id="location">São Paulo, SP</span>
                        </div>
                    </div>
                </div>

                <div class="details-section">
                    <h3>Estatísticas</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <i class="fas fa-store"></i>
                            <div class="stat-info">
                                <span class="stat-number">0</span>
                                <span class="stat-label">Bazares Criados</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-heart"></i>
                            <div class="stat-info">
                                <span class="stat-number">12</span>
                                <span class="stat-label">Favoritos</span>
                            </div>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-eye"></i>
                            <div class="stat-info">
                                <span class="stat-number">248</span>
                                <span class="stat-label">Visualizações</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="details-section">
                    <h3>Análise e Relatórios por Bazar</h3>
                    <div class="bazar-analytics" id="bazarAnalytics">
                        <!-- Análises serão carregadas dinamicamente -->
                    </div>
                </div>
                
                <div class="details-section">
                    <h3>Meus Bazares</h3>
                    <div class="bazares-list" id="userBazaresList">
                        <!-- Bazares serão carregados dinamicamente -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div class="modal" id="editModal">
        <div class="modal-content">
            <span class="close" id="closeModal">&times;</span>
            <h2>Editar Perfil</h2>
            <form class="edit-form" id="editForm">
                <div class="form-group">
                    <label>Nome Completo</label>
                    <input type="text" id="editFullName" value="Maria Silva Santos">
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="editEmail" value="maria.silva@email.com">
                </div>
                <div class="form-group">
                    <label>Telefone</label>
                    <input type="tel" id="editPhone" value="(11) 99999-9999">
                </div>
                <div class="form-group">
                    <label>Localização</label>
                    <input type="text" id="editLocation" value="São Paulo, SP">
                </div>
                <div class="form-actions">
                    <button type="button" class="cancel-btn" id="cancelEdit">Cancelar</button>
                    <button type="submit" class="save-btn">Salvar</button>
                </div>
            </form>
        </div>
    </div>
    </div>
    </div>

    <script src="../js/perfil-script.js"></script>
    <script src="../js/dark-mode-global.js"></script>
    <script src="../js/analytics.js"></script>
    <script>
        function toggleDarkMode() {
            const isDark = localStorage.getItem('darkMode') === 'true';
            localStorage.setItem('darkMode', !isDark);
            applyDarkMode();
        }
        
        function applyDarkMode() {
            const isDark = localStorage.getItem('darkMode') === 'true';
            document.body.classList.toggle('dark-mode', isDark);
            updateDarkModeText();
        }
        
        // Carregar bazares do usuário
        function loadUserBazares() {
            const userBazares = JSON.parse(localStorage.getItem('userBazares') || '[]');
            const container = document.getElementById('userBazaresList');
            
            if (userBazares.length === 0) {
                container.innerHTML = '<p>Você ainda não criou nenhum bazar.</p>';
                return;
            }
            
            container.innerHTML = userBazares.map(bazar => `
                <div class="user-bazar-card">
                    <img src="${bazar.image || 'https://images.unsplash.com/photo-1441986300917-64674bd600d8?w=200&h=120&fit=crop'}" alt="${bazar.nome}">
                    <div class="bazar-info">
                        <h4>${bazar.nome}</h4>
                        <p>${bazar.descricao}</p>
                        <span>${bazar.cidade}</span>
                    </div>
                    <div class="bazar-actions">
                        <button class="edit-bazar-btn" onclick="editBazar(${bazar.id})">
                            <i class="fas fa-edit"></i> Editar
                        </button>
                        <button class="delete-bazar-btn" onclick="deleteBazar(${bazar.id})">
                            <i class="fas fa-trash"></i> Excluir
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        function editBazar(id) {
            localStorage.setItem('editBazarId', id);
            window.location.href = 'editar-bazar.html';
        }
        
        function deleteBazar(id) {
            if (confirm('Tem certeza que deseja excluir este bazar?')) {
                let userBazares = JSON.parse(localStorage.getItem('userBazares') || '[]');
                userBazares = userBazares.filter(bazar => bazar.id != id);
                localStorage.setItem('userBazares', JSON.stringify(userBazares));
                
                let allBazares = JSON.parse(localStorage.getItem('fashionspace_bazares') || '[]');
                allBazares = allBazares.filter(bazar => bazar.id != id);
                localStorage.setItem('fashionspace_bazares', JSON.stringify(allBazares));
                
                loadUserBazares();
            }
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            applyDarkMode();
            loadUserBazares();
            loadBazarAnalytics();
            
            const menuToggle = document.getElementById('menuToggle');
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.querySelector('.main-content');
            
            if (menuToggle && sidebar && mainContent) {
                menuToggle.addEventListener('click', function() {
                    sidebar.classList.toggle('active');
                    mainContent.classList.toggle('shifted');
                });
            }
        });
        
        function updateDarkModeText() {
            const isDark = localStorage.getItem('darkMode') === 'true';
            const darkModeText = document.getElementById('darkModeText');
            if (darkModeText) {
                darkModeText.textContent = isDark ? 'Modo Claro' : 'Modo Escuro';
            }
        }
    </script>
</body>
</html>