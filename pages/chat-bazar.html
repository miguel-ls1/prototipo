<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat - FashionSpace</title>
    <link rel="stylesheet" href="../css/chat-bazar.css">
    <link rel="stylesheet" href="../css/dark-mode-detalhes.css">
    <link rel="stylesheet" href="../css/dark-mode-global.css">
    <link rel="stylesheet" href="../css/animations.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <button class="back-btn" onclick="history.back()">
                <i class="fas fa-arrow-left"></i>
            </button>
            <div class="chat-info">
                <div class="chat-avatar" id="bazarAvatar">BV</div>
                <div class="chat-details">
                    <h3 id="bazarName">Bazar da Moda Vintage</h3>
                    <span class="status online">Online</span>
                </div>
            </div>

        </div>

        <div class="chat-messages" id="chatMessages">
            <!-- Mensagens serão carregadas aqui -->
        </div>

        <div class="chat-input">
            <input type="text" id="messageInput" placeholder="Digite sua mensagem..." onkeypress="handleEnter(event)">
            <button class="send-btn" onclick="sendMessage()">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <script>
        const predefinedResponses = [
            "Olá! Bem-vindo ao nosso bazar! Como posso ajudá-lo?",
            "Claro! Temos uma grande variedade de peças dos anos 70, 80 e 90",
            "Que tipo de peça você está procurando?",
            "Perfeito! Temos várias jaquetas jeans autênticas dos anos 80",
            "Os preços variam de R$ 80 a R$ 200, dependendo do estado e marca",
            "Sim! Posso enviar fotos pelo WhatsApp ou você pode vir conhecer pessoalmente",
            "Nosso endereço é Rua Augusta, 1234 - Consolação",
            "Funcionamos de terça a sábado, das 10h às 19h",
            "Domingos das 14h às 18h",
            "Perfeito! Te esperamos aqui. Qualquer dúvida, é só chamar!",
            "Temos sim! Venha dar uma olhada",
            "Pode passar aqui quando quiser",
            "Obrigado pela mensagem!",
            "Vou verificar isso para você",
            "Fico no aguardo da sua visita"
        ];
        
        let responseIndex = 0;

        function loadMessages() {
            const container = document.getElementById('chatMessages');
            container.innerHTML = '';
            
            // Adicionar apenas mensagem de boas-vindas
            const welcomeDiv = document.createElement('div');
            welcomeDiv.className = 'message received';
            welcomeDiv.innerHTML = `
                <div class="message-content">${predefinedResponses[0]}</div>
                <div class="message-time">${new Date().getHours().toString().padStart(2, '0')}:${new Date().getMinutes().toString().padStart(2, '0')}</div>
            `;
            container.appendChild(welcomeDiv);
            responseIndex = 1;
            
            container.scrollTop = container.scrollHeight;
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            
            if (!text) return;
            
            const container = document.getElementById('chatMessages');
            const now = new Date();
            const time = now.getHours().toString().padStart(2, '0') + ':' + 
                         now.getMinutes().toString().padStart(2, '0');
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message sent';
            messageDiv.innerHTML = `
                <div class="message-content">${text}</div>
                <div class="message-time">${time}</div>
            `;
            
            container.appendChild(messageDiv);
            container.scrollTop = container.scrollHeight;
            
            input.value = '';
            
            // Simular resposta automática com respostas pré-definidas
            setTimeout(() => {
                let response;
                if (responseIndex < predefinedResponses.length) {
                    response = predefinedResponses[responseIndex];
                    responseIndex++;
                } else {
                    // Se acabaram as respostas pré-definidas, usar respostas genéricas
                    const genericResponses = [
                        'Obrigado pela mensagem!',
                        'Vou verificar isso para você',
                        'Pode passar aqui quando quiser',
                        'Temos sim! Venha dar uma olhada',
                        'Fico no aguardo da sua visita'
                    ];
                    response = genericResponses[Math.floor(Math.random() * genericResponses.length)];
                }
                
                const responseTime = new Date();
                const responseTimeStr = responseTime.getHours().toString().padStart(2, '0') + ':' + 
                                       responseTime.getMinutes().toString().padStart(2, '0');
                
                const responseDiv = document.createElement('div');
                responseDiv.className = 'message received';
                responseDiv.innerHTML = `
                    <div class="message-content">${response}</div>
                    <div class="message-time">${responseTimeStr}</div>
                `;
                
                container.appendChild(responseDiv);
                container.scrollTop = container.scrollHeight;
            }, 2000);
        }

        function handleEnter(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        function applyDarkMode() {
            const isDark = localStorage.getItem('darkMode') === 'true';
            document.body.classList.toggle('dark-mode', isDark);
        }

        // Carregar bazar da URL
        function loadBazarInfo() {
            const urlParams = new URLSearchParams(window.location.search);
            const bazarName = decodeURIComponent(urlParams.get('bazar') || 'Bazar da Moda Vintage');
            
            document.getElementById('bazarName').textContent = bazarName;
            document.getElementById('bazarAvatar').textContent = bazarName.substring(0, 2).toUpperCase();
            document.title = `Chat - ${bazarName}`;
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadBazarInfo();
            loadMessages();
            applyDarkMode();
        });
    </script>
    <script src="../js/animations.js"></script>
</body>
</html>